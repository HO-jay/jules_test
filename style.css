body {
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh; /* 최소 높이를 화면 전체로 */
    background-color: #e0e0e0; /* 배경색 약간 변경 */
    margin: 0;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; /* 가독성 좋은 폰트 */
    padding: 20px; /* 페이지 전체에 여백 */
    box-sizing: border-box;
}

.calculator {
    border: 1px solid #b0b0b0; /* 테두리 약간 어둡게 */
    border-radius: 12px; /* 둥근 모서리 증가 */
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.15); /* 그림자 강화 */
    overflow: hidden;
    width: 100%;
    max-width: 420px; /* 계산기 최대 너비 조정 */
    background-color: #f5f5f5; /* 계산기 기본 배경색 */
}

.display {
    background-color: #1c1c1c; /* 더 어두운 배경 */
    padding: 15px 20px; /* 상단 패딩을 줄여 수식 표시 공간 확보 */
    text-align: right;
    margin-bottom: 0; /* 버튼 그룹과 바로 붙도록 */
    border-bottom: 1px solid #444; /* 디스플레이 하단 구분선 */
    min-height: 80px; /* 주 화면과 수식 표시줄을 포함할 수 있는 최소 높이 */
    display: flex;
    flex-direction: column;
    justify-content: space-around;
}

.expression-display {
    font-size: 0.7em; /* 주 화면보다 작은 폰트 */
    color: #a0a0a0;   /* 연한 회색 */
    height: 1.5em;     /* 한 줄 높이 정도 */
    line-height: 1.5em;
    text-align: right;
    overflow: hidden;
    white-space: nowrap;
    text-overflow: ellipsis;
    margin-bottom: 5px; /* 주 결과 표시줄과의 간격 */
    opacity: 0.7; /* 약간 흐리게 */
}

.display input#result { /* ID를 명시하여 정확히 타겟팅 */
    width: 100%;
    background-color: transparent; /* 배경 투명 */
    color: white;
    border: none;
    font-size: 2.8em; /* 폰트 크기 증가 */
    text-align: right;
    box-sizing: border-box;
    font-weight: 300; /* 얇은 폰트 */
}

/* 기본 버튼 스타일 초기화 및 재정의 */
button {
    background-color: #e0e0e0;
    border: none;
    padding: 15px; /* 패딩 조정 */
    font-size: 1.1em; /* 기본 폰트 크기 조정 */
    cursor: pointer;
    transition: background-color 0.2s, box-shadow 0.2s;
    border-radius: 8px; /* 버튼 둥근 모서리 */
    color: #333;
    box-shadow: 0 2px 3px rgba(0,0,0,0.1);
}

button:hover {
    background-color: #d5d5d5;
    box-shadow: 0 3px 5px rgba(0,0,0,0.15);
}

button:active {
    background-color: #cccccc;
    box-shadow: inset 0 1px 3px rgba(0,0,0,0.1);
}

/* .buttons는 이제 함수와 키패드 컨테이너 */
.buttons {
    padding: 10px; /* 내부 그리드와 컨테이너 사이 여백 */
    background-color: #dcdcdc; /* 버튼 영역 배경 */
}

.function-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr); /* 함수 버튼 3열로 변경 */
    gap: 8px;
    margin-bottom: 10px; /* 함수 그룹과 키패드 그룹 사이 여백 */
}

.function-grid button, /* 함수 그룹 내 버튼 공통 스타일 */
.mode-toggle.function { /* F<=>D 버튼도 함수 그룹 스타일 적용 */
    background-color: #b0bec5; /* Blue Grey Lighten-3 */
    color: #263238; /* Blue Grey Darken-3 */
    font-size: 0.9em;
}
.function-grid button:hover,
.mode-toggle.function:hover {
    background-color: #90a4ae; /* Blue Grey Lighten-2 */
}
.function-grid button.operator { /* ^ 버튼은 연산자 색상 유지 가능 */
    background-color: #ffab40; /* Orange A200 */
    color: white;
}
.function-grid button.operator:hover {
    background-color: #ff9100; /* Orange A400 */
}


.keypad-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    grid-template-rows: repeat(5, auto); /* 행 높이는 내용에 맞게 */
    gap: 8px; /* 버튼 간 간격 */
}

/* 키패드 버튼 기본 스타일 */
.keypad-grid button {
    padding: 20px 15px; /* 키패드 버튼 패딩 증가 */
    font-size: 1.4em; /* 키패드 버튼 폰트 크기 증가 */
}

.keypad-grid .number, .keypad-grid .decimal {
    background-color: #f5f5f5; /* 숫자 버튼 배경 */
    color: #212121;
}
.keypad-grid .number:hover, .keypad-grid .decimal:hover {
    background-color: #eeeeee;
}

.keypad-grid .operator {
    background-color: #ffab40; /* Orange A200 */
    color: white;
}
.keypad-grid .operator:hover {
    background-color: #ff9100; /* Orange A400 */
}

.keypad-grid .clear {
    background-color: #ef5350; /* Red Lighten-1 */
    color: white;
    /* grid-column: span 1; 기본값 */
}
.keypad-grid .clear:hover {
    background-color: #e53935; /* Red */
}

.keypad-grid .equals {
    background-color: #66bb6a; /* Green Lighten-1 */
    color: white;
    grid-column: span 2; /* = 버튼은 2칸 차지 */
}
.keypad-grid .equals:hover {
    background-color: #4caf50; /* Green */
}

/* grid-item-X 클래스를 사용한 정확한 위치 지정 (선택적, grid-area로 대체 가능) */
.grid-item-C  { grid-area: 1 / 1; }
/* +/- 와 % 버튼이 있다면 아래 주석 해제하고 grid-area 수정 */
/* .grid-item-pm { grid-area: 1 / 2; }  */
/* .grid-item-mod { grid-area: 1 / 3; } */
.grid-item-div { grid-area: 1 / 2; } /* 현재 +/- % 버튼 없으므로 /가 2번째 칸으로 */
.grid-item-mul { grid-area: 1 / 3; }
.grid-item-sub { grid-area: 1 / 4; }

.grid-item-7  { grid-area: 2 / 1; }
.grid-item-8  { grid-area: 2 / 2; }
.grid-item-9  { grid-area: 2 / 3; }
.grid-item-add { grid-area: 2 / 4 / 4 / 5; } /* + 버튼은 2행 차지 (row-start / col-start / row-end / col-end) */

.grid-item-4  { grid-area: 3 / 1; }
.grid-item-5  { grid-area: 3 / 2; }
.grid-item-6  { grid-area: 3 / 3; }

.grid-item-1  { grid-area: 4 / 1; }
.grid-item-2  { grid-area: 4 / 2; }
.grid-item-3  { grid-area: 4 / 3; }
.grid-item-eq { grid-area: 4 / 4 / 6 / 5; } /* = 버튼은 2행 차지 */

.grid-item-0  { grid-area: 5 / 1 / 6 / 3; } /* 0 버튼은 2칸 차지 */
.grid-item-dot { grid-area: 5 / 3 / 6 / 4; }


/* --- 보조 기능 섹션 공통 스타일 --- */
.statistics-controls, /* 통계 섹션도 공통 스타일 적용 */
.matrix-controls,
.equation-solver-controls,
.history-controls,
.graphing-controls,
.history-display-area {
    margin-top: 15px;
    border-top: 2px solid #c0c0c0; /* 구분선 색상 변경 */
    padding-top: 15px;
}

/* 각 섹션 제목 공통 스타일 */
.statistics-controls h4, /* 통계 섹션 제목 */
.matrix-controls h4,
.equation-solver-controls h4,
.graphing-controls h4 {
    grid-column: 1 / -1;
    text-align: center;
    margin-top: 0;
    margin-bottom: 15px; /* 제목과 내용 간 여백 증가 */
    font-size: 1.0em; /* 폰트 크기 조정 */
    color: #333;
    border-bottom: 1px solid #d0d0d0;
    padding-bottom: 8px; /* 패딩 조정 */
    font-weight: 600; /* 제목 폰트 두께 */
}

/* 통계 버튼 섹션 */
.statistics-controls {
    padding-left: 10px; padding-right: 10px; padding-bottom: 10px;
    background-color: #e8f5e9; /* Green Lighten-5 */
}
.stats-buttons-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)); /* 반응형 그리드 */
    gap: 8px;
}
.stats-buttons-grid button { /* 통계 버튼 공통 스타일 */
    background-color: #a5d6a7; /* Green Lighten-3 */
    color: #1b5e20; /* Green Darken-4 */
    font-size: 0.9em;
}
.stats-buttons-grid button:hover {
    background-color: #81c784; /* Green Lighten-2 */
}
.stats-buttons-grid .clear-data { /* 통계 데이터 지우기 버튼 */
    background-color: #ef9a9a; /* Red Lighten-3 */
    color: #c62828; /* Red Darken-3 */
    /* grid-column: span X; 필요시 너비 조정 */
}
.stats-buttons-grid .clear-data:hover {
    background-color: #e57373; /* Red Lighten-2 */
}


/* 행렬 컨트롤 스타일 */
.matrix-controls {
    padding-left: 10px; padding-right: 10px; padding-bottom: 10px;
    background-color: #eceff1;
    display: grid;
    grid-template-columns: 1fr auto;
    gap: 8px;
    align-items: center;
}
.matrix-controls input[type="text"] { /* 스타일 유지 */
    padding: 10px; border: 1px solid #ccc; border-radius: 4px; font-size: 0.9em;
    width: 100%; box-sizing: border-box;
}
.matrix-button, .matrix-op-button { /* 스타일 유지 또는 약간 조정 */
    padding: 10px 15px; font-size: 0.9em; color: white;
    border: none; border-radius: 4px; cursor: pointer; transition: background-color 0.2s;
}
.matrix-button { background-color: #78909c; } /* Blue Grey Lighten-1 */
.matrix-button:hover { background-color: #607d8b; }
.matrix-op-button { background-color: #009688; } /* Teal */
.matrix-op-button:hover { background-color: #00796b; }
#matrixAInput, #storeMatrixA, #matrixBInput, #storeMatrixB,
#addMatrices, #subtractMatrices, #multiplyMatrices { /* grid-column 설정 유지 */
    /* 기존 grid-column 설정 유지 */
}
#addMatrices { grid-column: 1 / 2; }
#subtractMatrices { grid-column: 2 / 3; }
#multiplyMatrices { grid-column: 1 / 2; margin-top: 5px; } /* 다음 줄로 확실히 넘기기 위해 margin-top 추가 */


/* 방정식 풀이 컨트롤 스타일 */
.equation-solver-controls {
    padding-left: 10px; padding-right: 10px; padding-bottom: 10px;
    background-color: #f3e5f5;
    display: grid;
    grid-template-columns: repeat(3, minmax(60px, 1fr));
    gap: 8px;
    align-items: center;
}
.equation-solver-controls input[type="text"] { /* 스타일 유지 */
    padding: 10px; border: 1px solid #ccc; border-radius: 4px; font-size: 0.9em;
    width: 100%; box-sizing: border-box; text-align: center;
}
.solver-button { /* 스타일 유지 또는 약간 조정 */
    grid-column: 1 / -1; padding: 10px 15px; font-size: 0.9em;
    background-color: #7e57c2; /* Deep Purple Lighten-1 */
    color: white; border: none; border-radius: 4px; cursor: pointer;
    transition: background-color 0.2s; margin-top: 5px;
}
.solver-button:hover { background-color: #673ab7; } /* Deep Purple */


/* 히스토리 컨트롤 및 표시 영역 스타일 */
.history-controls {
    padding-left: 10px; padding-right: 10px; padding-bottom: 10px;
    background-color: #e8f5e9;
    display: flex; justify-content: space-around; gap: 8px;
}
.history-button { /* 스타일 약간 조정 */
    padding: 8px 12px; font-size: 0.9em; /* 폰트 크기 통일 */
    background-color: #8bc34a; /* Light Green */
    color: white; border: none; border-radius: 4px; cursor: pointer;
    transition: background-color 0.2s; flex-grow: 1;
}
.history-button:hover { background-color: #7cb342; }
.history-display-area { /* 스타일 유지 또는 약간 조정 */
    max-height: 150px; overflow-y: auto; border: 1px solid #a5d6a7;
    padding: 10px; margin-left: 10px; margin-right: 10px; margin-bottom: 10px;
    background-color: #ffffff; border-radius: 4px;
    font-size: 0.9em; line-height: 1.4;
}
.history-item { /* 스타일 유지 */
    padding: 5px 0; border-bottom: 1px dashed #dcedc8; word-wrap: break-word;
}
.history-item:last-child { border-bottom: none; }


/* 그래프 컨트롤 및 캔버스 스타일 */
.graphing-controls {
    padding-left: 10px; padding-right: 10px; padding-bottom: 10px;
    background-color: #e0f7fa;
    display: grid; grid-template-columns: 1fr; gap: 8px; align-items: center;
}
.graphing-controls input[type="text"] { /* 스타일 유지 */
    padding: 10px; border: 1px solid #ccc; border-radius: 4px;
    font-size: 0.9em; width: 100%; box-sizing: border-box;
}
.graphing-button { /* 스타일 약간 조정 */
    padding: 10px 15px; font-size: 0.9em;
    background-color: #26c6da; /* Cyan Lighten-1 */
    color: white; border: none; border-radius: 4px; cursor: pointer;
    transition: background-color 0.2s;
}
.graphing-button:hover { background-color: #00bcd4; } /* Cyan */
#graphCanvas { /* 스타일 유지 */
    width: 100%; max-width: 400px; height: auto; aspect-ratio: 400 / 300;
    display: block; margin-left: auto; margin-right: auto;
}
